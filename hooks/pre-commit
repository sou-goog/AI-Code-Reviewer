#!/usr/bin/env python3
"""
Pre-commit hook for AI Code Reviewer.
Automatically reviews staged changes before commit.

Installation:
    python setup_hooks.py
"""
import subprocess
import sys
import os

def main():
    print("üîç Running AI Code Review on staged changes...")
    
    # Check if GEMINI_API_KEY is set
    if not os.environ.get("GEMINI_API_KEY"):
        print("‚ö†Ô∏è  Warning: GEMINI_API_KEY not set. Skipping AI review.")
        print("   Set it with: export GEMINI_API_KEY=your_key")
        return 0
    
    # Run the review
    try:
        result = subprocess.run(
            ["python", "-m", "src.main", "review", "--format", "terminal"],
            capture_output=True,
            text=True,
            timeout=60
        )
        
        if result.returncode != 0:
            print("‚ùå AI Review failed:")
            print(result.stderr)
            return 1
        
        # Show the review
        print(result.stdout)
        
        # Ask user if they want to proceed
        response = input("\nü§î Proceed with commit? [y/N]: ")
        if response.lower() not in ['y', 'yes']:
            print("‚ùå Commit aborted.")
            return 1
        
        print("‚úÖ Proceeding with commit.")
        return 0
        
    except subprocess.TimeoutExpired:
        print("‚ö†Ô∏è  AI Review timed out. Proceeding with commit.")
        return 0
    except Exception as e:
        print(f"‚ö†Ô∏è  Error during review: {e}. Proceeding with commit.")
        return 0

if __name__ == "__main__":
    sys.exit(main())
